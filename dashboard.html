<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Play Consysencia | V5 Ultra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* ============================ CSS MICRO-DETALHISTA (PLUS) ============================ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap');

        :root {
            --bg: #070a0b; --bg-2: #0b0f10; --text: #ffffff; --muted: rgba(255,255,255,.72);
            --accent: #00ff88; --accent-2: rgba(0,255,136,.15); --radius: 10px; --radius-2: 14px;
            --shadow-1: 0 8px 24px rgba(0,0,0,.35); --shadow-2: 0 12px 36px rgba(0,0,0,.55);
            --nav-grad: linear-gradient(to bottom, rgba(0,0,0,0.85), transparent);
            --btn-bg: rgba(255,255,255,.06); --btn-bd: rgba(255,255,255,.14);
            --card-bg: rgba(255,255,255,.04); --card-bd: rgba(255,255,255,.08);
            --menu-bg: rgba(0,0,0,.90);
        }

        /* TEMA NETFLIX: Vermelho Original + Bebas */
        body[data-theme="netflix"] {
            --bg: #141414; --bg-2: #0f0f0f; --accent: #E50914; --accent-2: rgba(229,9,20,.18);
            --brand-font: "Bebas Neue", sans-serif;
            --nav-grad: linear-gradient(to bottom, rgba(20,20,20,.92), transparent);
        }

        /* TEMA PRIME: Azul Amazon + Radius 12px */
        body[data-theme="prime"] {
            --bg: #0f171e; --bg-2: #0b1116; --accent: #00A8E1; --accent-2: rgba(0,168,225,.18);
            --radius: 12px; --radius-2: 16px;
            --nav-grad: linear-gradient(to bottom, rgba(15,23,30,.92), transparent);
        }

        /* TEMA DISNEY: Azul Royal */
        body[data-theme="disney"] {
            --bg: #1a1d29; --bg-2: #121422; --accent: #0063e5; --accent-2: rgba(0,99,229,.18);
        }

        /* RESET E ESTRUTURA BASE */
        *{ margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: "Inter", sans-serif; overflow: hidden; transition: 0.35s; }
        
        /* NAVBAR E SIDEBAR */
        .navbar { position: fixed; top: 0; width: 100%; height: 70px; display:flex; align-items:center; padding: 0 4%; gap: 16px; background: var(--nav-grad); z-index: 1000; backdrop-filter: blur(10px); }
        .sidebar { position: fixed; left: -280px; top: 0; width: 280px; height: 100vh; background: var(--menu-bg); z-index: 2000; transition: left .26s cubic-bezier(.2,.8,.2,1); padding: 36px 18px; backdrop-filter: blur(14px); border-right: 1px solid rgba(255,255,255,0.1); }
        .sidebar.open { left: 0; }
        .sidebar h2 { color: var(--accent); margin-bottom: 26px; letter-spacing: 2px; font-weight: 900; transition: 0.3s; }
        body[data-theme="netflix"] .sidebar h2 { font-family: var(--brand-font); font-size: 34px; letter-spacing: 2.2px; }

        .menu-item { padding: 13px 12px; margin-bottom: 6px; border-radius: var(--radius); cursor: pointer; display:flex; align-items:center; gap: 12px; color: rgba(255,255,255,.62); transition: 0.2s; font-weight: 800; }
        .menu-item.active { background: rgba(255,255,255,0.08); border-color: var(--accent-2); color: var(--accent); }
        body[data-theme="netflix"] .menu-item:hover { background: rgba(229,9,20,.10); color: #fff; }

        /* GRID E CARDS MILENARES */
        #catalog-root { width: 100vw; height: 100vh; overflow-y: auto; padding-top: 80px; scroll-behavior: smooth; }
        .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 18px; padding: 18px 4%; }
        .card { background: var(--card-bg); border-radius: var(--radius); overflow: hidden; position: relative; aspect-ratio: 2/3; cursor: pointer; border: 1px solid var(--card-bd); transition: 0.2s; box-shadow: var(--shadow-1); }
        .card.live { aspect-ratio: 16/9; }
        .card:hover { border-color: var(--accent); transform: translateY(-4px) scale(1.04); z-index: 10; box-shadow: var(--shadow-2); }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-name { position: absolute; bottom: 0; width: 100%; padding: 16px 10px 8px; background: linear-gradient(to top, rgba(0,0,0,0.88), transparent); font-size: 11px; text-align: center; font-weight: 900; text-shadow: 0 2px 10px black; }

        /* PLAYER UNMOUNT */
        #player-root { display:none; position: fixed; inset: 0; background: #000; z-index: 5000; }
        .p-controls { position:absolute; top:0; width:100%; padding: 22px; display:flex; justify-content: space-between; align-items:center; z-index: 10; background: linear-gradient(rgba(0,0,0,0.92), transparent); }
        video { width:100%; height:100%; object-fit: contain; }
        .btn-back { background: var(--btn-bg); color: #fff; padding: 12px 16px; border-radius: var(--radius); font-weight: 900; border: 1px solid var(--btn-bd); cursor: pointer; transition: 0.2s; }
        .btn-back:hover { background: var(--accent); color: black; }

        /* LOADER */
        .loader { position: fixed; inset: 0; background: var(--bg-2); display:flex; align-items:center; justify-content:center; z-index: 9000; color: var(--accent); font-weight: 900; flex-direction: column; gap: 14px; }
        .spinner { width: 38px; height: 38px; border: 4px solid rgba(255,255,255,.10); border-top-color: var(--accent); border-radius: 50%; animation: spin .9s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loader" class="loader"><div class="spinner"></div>Sincronizando Multiverso...</div>

<div id="sidebar" class="sidebar">
    <h2 id="brand-name">CONSYSENCIA</h2>
    <div class="menu-item active" onclick="loadTab('live', 'consysencia')"><i class="fa-solid fa-tv"></i> TV AO VIVO</div>
    <div class="menu-item" onclick="loadTab('netflix', 'netflix')"><i class="fa-brands fa-neos"></i> NETFLIX</div>
    <div class="menu-item" onclick="loadTab('prime', 'prime')"><i class="fa-brands fa-amazon"></i> PRIME VIDEO</div>
    <div class="menu-item" onclick="loadTab('disney', 'disney')"><i class="fa-brands fa-play"></i> DISNEY+</div>
    <div class="menu-item" style="margin-top:20px; color:#ff4444;" onclick="localStorage.clear(); location.href='index.html'"><i class="fa-solid fa-power-off"></i> SAIR</div>
</div>

<div id="catalog-root">
    <div class="navbar">
        <div onclick="document.getElementById('sidebar').classList.toggle('open')" style="cursor:pointer; font-size: 22px; color: var(--accent);"><i class="fa-solid fa-bars"></i></div>
        <h2 id="view-title">Canais ao Vivo</h2>
    </div>
    <div class="grid" id="grid-content"></div>
</div>

<div id="player-root">
    <div class="p-controls">
        <button class="btn-back" onclick="closeVideo()"><i class="fa-solid fa-arrow-left"></i> VOLTAR</button>
        <div id="v-title" style="font-weight: 900;"></div>
    </div>
    <video id="main-video" controls autoplay playsinline></video>
</div>

<script>
    const user = localStorage.getItem('cs_user');
    const pass = localStorage.getItem('cs_pass');
    const api = 'https://api.consysencia.com/catalog';
    const rawServer = 'http://ph1233.uk';

    let DB = { live: [], vod: [], live_cat: [], vod_cat: [] };

    async function init() {
        if(!user) return location.href = 'index.html';
        try {
            const h = { 'Authorization': 'Basic ' + btoa(user + ':' + pass) };
            const [lcat, lstr, vcat, vstr] = await Promise.all([
                fetch(`${api}?action=get_live_categories`, {headers:h}).then(r=>r.json()),
                fetch(`${api}?action=get_live_streams`, {headers:h}).then(r=>r.json()),
                fetch(`${api}?action=get_vod_categories`, {headers:h}).then(r=>r.json()),
                fetch(`${api}?action=get_vod_streams`, {headers:h}).then(r=>r.json())
            ]);
            DB = { live: lstr, vod: vstr, live_cat: lcat, vod_cat: vcat };
            document.getElementById('loader').style.display = 'none';
            loadTab('live', 'consysencia');
        } catch(e) { alert("Erro de conex√£o."); }
    }

    function loadTab(type, theme) {
        document.getElementById('sidebar').classList.remove('open');
        document.body.dataset.theme = theme;
        
        const grid = document.getElementById('grid-content');
        const title = document.getElementById('view-title');
        grid.innerHTML = '<p>Carregando...</p>';
        
        let items = [];
        if(type === 'live') {
            title.innerText = "Canais ao Vivo";
            items = DB.live.slice(0, 400);
        } else {
            title.innerText = type.toUpperCase();
            // FILTRO CASE-INSENSITIVE PARA PASTAS
            const validCats = DB.vod_cat.filter(c => c.category_name.toLowerCase().includes(type.toLowerCase())).map(c => c.category_id);
            items = DB.vod.filter(v => validCats.includes(v.category_id));
        }

        grid.innerHTML = items.map(item => `
            <div class="card ${type === 'live' ? 'live' : 'vod'}" onclick="openVideo('${item.stream_id}', '${item.name.replace(/'/g, "")}', '${type}', '${item.container_extension || 'mp4'}')">
                <img src="${item.stream_icon}" loading="lazy" onerror="this.src='https://placehold.co/400x600/111/fff?text=Play'">
                <div class="card-name">${item.name}</div>
            </div>
        `).join('');

        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        if(event && event.currentTarget) event.currentTarget.classList.add('active');
    }

    let hls;
    function openVideo(id, name, type, ext) {
        document.getElementById('catalog-root').style.display = 'none'; // Unmount visual
        document.getElementById('player-root').style.display = 'flex';
        document.getElementById('v-title').innerText = name;
        
        const video = document.getElementById('main-video');
        const url = type === 'live' ? `${rawServer}/live/${user}/${pass}/${id}.m3u8` : `${rawServer}/movie/${user}/${pass}/${id}.${ext}`;

        if(type === 'live' && Hls.isSupported()) {
            if(hls) hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else { video.src = url; video.play(); }
    }

    function closeVideo() {
        const video = document.getElementById('main-video');
        video.pause(); video.src = "";
        if(hls) hls.destroy();
        document.getElementById('player-root').style.display = 'none';
        document.getElementById('catalog-root').style.display = 'block';
    }

    init();
</script>
</body>
</html>
